# AGENTS.md

## \U0001F4D8 Что такое агент?
Агент — это строго изолированный модуль SAGE Engine, реализующий определённую функциональность.
Он подключается к циклу движка через `core.register()` и исполняет код в фазах `boot`, `update`,
`draw`, `flush` и `shutdown`. Агенты помогают разделить логику и избегать жёстких связей между модулями.

## \U0001F9E0 Примеры агентов
| Агент | Назначение |
|-------|------------|
| **InputAgent** | Обработка пользовательского ввода |
| **RenderAgent** | Формирование финального кадра |
| **ResourceAgent** | Загрузка, кеширование и освобождение ресурсов |
| **AIProcessingAgent** | Обработка логики NPC и AI |
| **PhysicsAgent** | Обработка столкновений и движения |

Ни один встроенный агент не создаёт бинарные файлы или временные артефакты.
Они читают только конфигурацию или кэш.

## \U0001F9E9 Архитектура фаз
Все агенты участвуют в системных фазах:

```
boot → update → draw → flush → shutdown
```

Граф зависимостей задаётся в `engine.sagecfg` и гарантирует корректный
порядок вызовов.

## \u2705 Пример: Input Agent
```python
from sage_engine import core
from sage_engine.agents.input_agent import InputAgent

core.register(InputAgent())
```

## \u2699\ufe0f Минимальный шаблон агента
```python
class MyAgent:
    def __init__(self):
        self.name = "MyAgent"

    def boot(self, cfg):
        # инициализация, чтение конфигурации
        pass

    def update(self, dt):
        # логика обновления, например таймеры
        pass

    def draw(self):
        # необязательная отрисовка
        pass

    def flush(self):
        # действия после кадра
        pass

    def shutdown(self):
        # очистка ресурсов
        pass
```

## \U0001F50C Интеграция
- Регистрируйте агент через `core.register()` в фазе `boot`.
- Файлы агентов размещаются в каталоге `sage_engine/agents/` и импортируются явно.

## \U0001F512 Ограничения и безопасность
- ❌ Прямой доступ к модулям движка (`gfx`, `render`, `input`, `objects`) запрещён.
- ✅ Используйте `core.get("module")` для получения интерфейсов.
- ✅ Все зависимости должны быть объявлены явно (`requires = [...]`).
- ✅ Агент обязан быть полностью тестируемым и логгируемым.
- ✅ Никаких побочных эффектов вне фаз.

## \U0001F501 Взаимодействие между агентами
Допустимые способы:
- События (`events.emit`, `events.on`).
- API, полученные через `core.get()`.

Глобальные переменные, синглтоны и хаки недопустимы.

## \U0001F4C2 Файловая организация
```
sage_engine/
└── agents/
    ├── input_agent.py
    ├── render_agent.py
    ├── resource_agent.py
    ├── my_agent.py
    └── ...
```

## \U0001F9EA Поведение `shutdown()`
Метод `shutdown()` обязан корректно освобождать ресурсы и
может генерировать исключения, если агент не был инициализирован
или уже завершён. В лог записывается информация об успешном
завершении или ошибке.

## \U0001F52E Примеры взаимодействия
```python
from sage_engine import events, core

# агент A отправляет событие
events.emit("player_damaged", amount=5)

# агент B подписывается на событие
events.on("player_damaged", lambda amount: print(f"HP-{amount}"))

# получение интерфейса другого агента
renderer = core.get("render")
if renderer:
    renderer.draw_sprite("hero")
```

## \U0001F393 Тесты
Каждый агент должен иметь модульные тесты и проверять изоляцию:
```
tests/
└── test_my_agent.py
```
При тестировании имитируйте фазы `boot`, `update`, `draw`, `flush`
и `shutdown` через `core.register()` и проверяйте отсутствие побочных
эффектов.



