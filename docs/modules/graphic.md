# üìò –ú–æ–¥—É–ª—å `graphic`

`graphic` v2 —Å—Ç—Ä–æ–∏—Ç—Å—è –Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–º —Ä–µ–Ω–¥–µ—Ä–µ –∏ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç OpenGL –∏–ª–∏ DirectX.
–ß–µ—Ä–µ–∑ API [`graphic.api`](../../sage_engine/graphic/api.py) –º–æ–∂–Ω–æ —Ä–∏—Å–æ–≤–∞—Ç—å
—Å–ø—Ä–∞–π—Ç—ã –∏ –ª–∏–Ω–∏–∏, –∞ `flush()` –ø—Ä–∏–º–µ–Ω—è–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç—ã –∏ —Å—Ç–∏–ª–∏ –∫ –±—É—Ñ–µ—Ä—É.

–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- `api` ‚Äî –µ–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—ã–∑–æ–≤–∞ (`draw_sprite`, `draw_line`, `flush`)
- `fx` ‚Äî —ç—Ñ—Ñ–µ–∫—Ç—ã —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏—è
- `style` ‚Äî –ø–æ—Å—Ç‚Äë—Ñ–∏–ª—å—Ç—Ä—ã (`mono-dark`, `neo-retro` –∏ –¥—Ä.)
- `backend` ‚Äî –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è
- `state` ‚Äî —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

## üîπ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

–í—Å–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤–∫–ª—é—á–∞—é—Ç `schema_version`, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
—Ñ—É–Ω–∫—Ü–∏–µ–π `compat.convert()` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.

## üì¶ –û—Å–Ω–æ–≤–Ω—ã–µ –∫–ª–∞—Å—Å—ã

- `Layer(z)` ‚Äî –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –æ–±—ä–µ–∫—Ç–æ–≤ –Ω–∞ –æ–¥–Ω–æ–º –≥–ª—É–±–∏–Ω–Ω–æ–º —É—Ä–æ–≤–Ω–µ.
- `Group(state=None)` ‚Äî –Ω–∞–±–æ—Ä –ø—Ä–∏–º–∏—Ç–∏–≤–æ–≤ —Å–æ —Å–≤–æ–∏–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º. –ü—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–µ
  —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Å—Ç–µ–∫–æ–≤–æ.
- `Scene` ‚Äî —Ö—Ä–∞–Ω–∏—Ç –Ω–∞–±–æ—Ä —Å–ª–æ–µ–≤ –∏ –≤—ã–≤–æ–¥–∏—Ç –∏—Ö —á–µ—Ä–µ–∑ `render()`.

## üîß –°—Ç–∏–ª–∏

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `gfx.push_state()` –∏ `gfx.pop_state()` –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è
`gfx.state`. –°–æ—Å—Ç–æ—è–Ω–∏–µ –º–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —á–µ—Ä–µ–∑ `snapshot()` –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —á–µ—Ä–µ–∑
`restore()`.

## üîπ –ü—Ä–∏–º–∏—Ç–∏–≤—ã

`gfx` –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ `draw_rect`, `draw_circle`, `draw_line`,
`draw_polygon`, `draw_rounded_rect` –∏ –∑–∞–≥–ª—É—à–∫—É `draw_text`.

## ‚ú® –≠—Ñ—Ñ–µ–∫—Ç—ã

–≠—Ñ—Ñ–µ–∫—Ç—ã —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏–µ–π `graphic.fx.register(name, func)` –∏ –º–æ–≥—É—Ç –±—ã—Ç—å
–ø—Ä–∏–º–µ–Ω–µ–Ω—ã —á–µ—Ä–µ–∑ `gfx.add_effect`.

## üîπ Pixel format

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ **BGRA8 premultiplied**. –í—Ö–æ–¥–Ω—ã–µ —Ü–≤–µ—Ç–∞
–ø—Ä–∏–≤–æ–¥—è—Ç—Å—è –∫ —ç—Ç–æ–º—É —Ñ–æ—Ä–º–∞—Ç—É —Ñ—É–Ω–∫—Ü–∏–µ–π `to_bgra8_premul`. –§–æ—Ä–º—É–ª—ã –±–ª–µ–Ω–¥–∏–Ω–≥–∞:

```
out.rgb = src.rgb + dst.rgb * (1 - src.a)
out.a   = src.a   + dst.a   * (1 - src.a)
```

## üîπ –û—á–∏—Å—Ç–∫–∞ –∫–∞–¥—Ä–∞

`gfx.begin_frame(clear=(0,0,0,255))` –≤—Å–µ–≥–¥–∞ –∑–∞–ø–æ–ª–Ω—è–µ—Ç –≤–µ—Å—å –±—É—Ñ–µ—Ä –∑–∞–¥–∞–Ω–Ω—ã–º
—Ü–≤–µ—Ç–æ–º. –°–ª–µ–¥—É–π—Ç–µ –ø–æ—Ä—è–¥–∫—É: `begin_frame` ‚Üí `scene.render()` ‚Üí –ø—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã
`gfx.draw_*` ‚Üí `end_frame`.

## üîπ Z –∏ –ø–æ—Ä—è–¥–æ–∫

–ö–æ–º–∞–Ω–¥—ã —Å–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –ø–æ `(z, seq)` –∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —Å—Ç–∞–±–∏–ª—å–Ω–æ. –û–±—ä–µ–∫—Ç—ã —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º
`z` —Ä–∏—Å—É—é—Ç—Å—è –≤ –ø–æ—Ä—è–¥–∫–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è.

## üîπ –ê–ª—å—Ñ–∞-–ø–æ–ª–∏—Ç–∏–∫–∞

–í—Å–µ —Ü–≤–µ—Ç–∞ —Å—á–∏—Ç–∞—é—Ç—Å—è premultiplied. –ü–æ–ª–µ–∑–Ω–æ –∑–∞—Ä–∞–Ω–µ–µ —É–º–Ω–æ–∂–∞—Ç—å `r`, `g`, `b` –Ω–∞
`a/255` –ø—Ä–∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏–∏ —Ü–≤–µ—Ç–æ–≤.
